<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- START: Meta Tags and Title -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Royal Gym</title>
    <!-- END: Meta Tags and Title -->

    <!-- START: External Stylesheets & Icons -->
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles/style.css" />
    <!-- END: External Stylesheets & Icons -->
  </head>
  <body>
    <!-- START: Header Section -->
    <header>
      <div class="logo">Royal <span>Gym</span></div>

      <!-- Navigation Menu -->
      <nav class="navbar">
        <a href="#home" class="active">Home</a>
        <a href="#services">Services</a>
        <a href="#about">About</a>
        <a href="#plans">Plans</a>
        <a href="#review">Reviews</a>
      </nav>

      <!-- Authentication Buttons -->
      <div class="auth-buttons">
        <a id="loginBtn" href="login.html" class="nav-btn">Login</a>
        <a
          id="dashboardBtn"
          href="user-dashboard.html"
          class="nav-btn"
          style="display: none"
          >Dashboard</a
        >
        <a id="logoutBtn" href="#" class="nav-btn" style="display: none"
          >Logout</a
        >
      </div>

      <!-- Mobile Menu Icon -->
      <div id="menu-icon"><i class="bx bx-menu"></i></div>
    </header>
    <!-- END: Header Section -->

    <!-- START: Main Content Sections -->

    <!-- START: Home Section -->
    <section class="home" id="home">
      <div class="home-content" data-aos="zoom-in">
        <h3>Build Your</h3>
        <h1>Dream Physique</h1>
        <h3><span class="multiple-text"></span></h3>

        <p>
          Lorem, ipsum dolor sit amet consectetur adipisicing elit. Commodi
          provident quia voluptatem corrupti ducimus vel.
        </p>

        <a href="registration.html" class="btn">Get Started</a>
      </div>

      <div class="home-img" data-aos="zoom-in">
        <img src="assets/gym best.png" alt="Home Image" />
      </div>
    </section>
    <!-- END: Home Section -->

    <!-- START: Services Section -->
    <section class="services" id="services">
      <h2 class="heading" data-aos="zoom-in-down">Our <span>Services</span></h2>

      <div class="services-content" data-aos="zoom-in-up">
        <div class="row">
          <img src="assets/image 1.jpeg" alt="Physical Fitness" />
          <h4>Physical Fitness</h4>
        </div>

        <div class="row">
          <img src="assets/image 2.jpeg" alt="Weight Gain" />
          <h4>Weight Gain</h4>
        </div>

        <div class="row">
          <img src="assets/image 3.jpeg" alt="Strength Training" />
          <h4>Strength Training</h4>
        </div>

        <div class="row">
          <img src="assets/image 4.jpeg" alt="Weight Lose" />
          <h4>Weight Lose</h4>
        </div>

        <div class="row">
          <img src="assets/image 5.jpeg" alt="Weight Lifting" />
          <h4>Weight Lifting</h4>
        </div>

        <div class="row">
          <img src="assets/image 6.jpeg" alt="Running" />
          <h4>Running</h4>
        </div>

        <div class="row">
          <img src="assets/image 7.jpeg" alt="Diet" />
          <h4>Diet</h4>
        </div>

        <div class="row">
          <img src="assets/image 9.jpeg" alt="Physiotherapy" />
          <h4>Physiotherapy</h4>
        </div>
      </div>
    </section>
    <!-- END: Services Section -->

    <!-- START: About Section -->
    <section class="about" id="about">
      <div class="about-img" data-aos="zoom-in-down">
        <img src="assets/image 6.jpeg" alt="About Image" />
      </div>

      <div class="about-content" data-aos="zoom-in-up">
        <h2 class="heading">Why Choose Us?</h2>

        <p>
          Our diverse membership base creates a friendly and supportive
          atmosphere, where you can make friends and stay motivated.
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Repellendus,
          alias!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Consectetur
          accusamus voluptate alias sit dolore nam fuga nihil.
        </p>

        <a href="#" class="btn">Book a Free Class</a>
      </div>
    </section>
    <!-- END: About Section -->

    <!-- START: Plans Section -->
    <section class="plans" id="plans">
      <h2 class="heading" data-aos="zoom-in-down">Our <span>Plans</span></h2>

      <div class="plans-content" id="plansContainer" data-aos="zoom-in-up">
        <!-- Plans will be loaded here by JavaScript -->
      </div>
    </section>
    <!-- END: Plans Section -->

    <!-- START: Reviews Section -->
    <section class="review" id="review">
      <div class="review-box">
        <h2 class="heading" data-aos="zoom-in-down">
          Client <span>Reviews</span>
        </h2>

        <div class="wrapper" data-aos="zoom-in-up">
          <div class="review-item">
            <img src="assets/image 10.jpeg" alt="John" />
            <h2>John</h2>
            <div class="rating">
              <i class="bx bxs-star" id="Star"></i>
              <i class="bx bxs-star" id="Star"></i>
              <i class="bx bxs-star" id="Star"></i>
              <i class="bx bxs-star" id="Star"></i>
              <i class="bx bxs-star" id="Star"></i>
            </div>
            <p>
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Aperiam,
              ipsam.
            </p>
          </div>

          <div class="review-item">
            <img src="assets/image 11.jpeg" alt="Steve" />
            <h2>Steve</h2>
            <div class="rating">
              <i class="bx bxs-star" id="Star"></i>
              <i class="bx bxs-star" id="Star"></i>
              <i class="bx bxs-star" id="Star"></i>
              <i class="bx bxs-star" id="Star"></i>
            </div>
            <p>
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Aperiam,
              ipsam.
            </p>
          </div>

          <div class="review-item">
            <img src="assets/image 12.jpeg" alt="David" />
            <h2>David</h2>
            <div class="rating">
              <i class="bx bxs-star" id="Star"></i>
              <i class="bx bxs-star" id="Star"></i>
              <i class="bx bxs-star" id="Star"></i>
              <i class="bx bxs-star" id="Star"></i>
              <i class="bx bxs-star" id="Star"></i>
            </div>
            <p>
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Aperiam,
              ipsam.
            </p>
          </div>
        </div>
      </div>
    </section>
    <!-- END: Reviews Section -->

    <!-- END: Main Content Sections -->

    <!-- START: Footer Section and Toast Container -->
    <footer class="footer">
      <div class="social">
        <a href="#"><i class="bx bxl-facebook"></i></a>
        <a href="#"><i class="bx bxl-instagram"></i></a>
        <a href="#"><i class="bx bxl-linkedin"></i></a>
      </div>

      <p class="copyright">&copy; Royal Gym 2025 - All Rights Reserved</p>
    </footer>
    <div id="toast-container"></div>
    <!-- END: Footer Section and Toast Container -->

    <!-- START: General Utility Scripts -->
    <!-- Toast Message Utility (Global function) -->
    <script>
      window.showToast = function (message, type = "success") {
        const container = document.getElementById("toast-container");

        const toast = document.createElement("div");
        toast.className = `toast toast-${type}`;
        toast.textContent = message;

        container.appendChild(toast);

        setTimeout(() => toast.remove(), 3000);
      };
    </script>

    <!-- AOS (Animate On Scroll) Library -->
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
      AOS.init({ offset: 300, duration: 1400 });
    </script>

    <!-- Typed.js (Text Animation) Library -->
    <script src="https://unpkg.com/typed.js@2.1.0/dist/typed.umd.js"></script>
    <script>
      if (typeof Typed !== "undefined") {
        new Typed(".multiple-text", {
          strings: ["Athlete", "Strength", "Endurance", "Confidence"],
          typeSpeed: 100,
          backSpeed: 60,
          backDelay: 1800,
          loop: true,
        });
      }
    </script>

    <!-- Navbar/Menu Toggle Logic -->
    <script>
      let menu = document.querySelector("#menu-icon");
      let navbar = document.querySelector(".navbar");

      if (menu) {
        menu.onclick = () => {
          menu.classList.toggle("bx-x");
          navbar.classList.toggle("active");
        };
      }

      window.onscroll = () => {
        menu?.classList.remove("bx-x");
        navbar?.classList.remove("active");
      };
    </script>
    <!-- END: General Utility Scripts -->

    <!-- START: Supabase Auth & Data Scripts (Type: module) -->
    <script type="module">
      import { supabase } from "./js/supabaseClient.js";

      // --- Authentication UI Update ---
      const loginBtn = document.getElementById("loginBtn");
      const dashboardBtn = document.getElementById("dashboardBtn");
      const logoutBtn = document.getElementById("logoutBtn");

      async function updateAuthUI() {
        const {
          data: { user },
        } = await supabase.auth.getUser();

        if (user) {
          loginBtn.style.display = "none";
          dashboardBtn.style.display = "inline-block";
          logoutBtn.style.display = "inline-block";
        } else {
          loginBtn.style.display = "inline-block";
          dashboardBtn.style.display = "none";
          logoutBtn.style.display = "none";
        }
      }

      logoutBtn?.addEventListener("click", async () => {
        await supabase.auth.signOut();
        window.location.reload();
      });

      updateAuthUI();

      // --- Load Plans Data ---
      const plansContainer = document.getElementById("plansContainer");

      async function loadPlans() {
        const { data, error } = await supabase
          .from("plans")
          .select("*")
          .order("created_at", { ascending: true });

        if (error) {
          plansContainer.innerHTML = `<p style="color:red">Failed to load plans</p>`;
          return;
        }

        plansContainer.innerHTML = data
          .map(
            (p) => `
          <div class="box">
            <h3>${p.title}</h3>
            <h2><span>${p.price}/${p.duration}</span></h2>
            <ul>${p.features.map((f) => `<li>${f}</li>`).join("")}</ul>
            <a href="#" onclick="handleBuyPlan('${p.id}')">
              <span>Join Now</span>
              <i class="bx bx-right-arrow-alt"></i>
            </a>
          </div>`
          )
          .join("");
      }

      loadPlans();

      // --- Handle Plan Purchase (Global function, accessible via window) ---
      window.handleBuyPlan = async function (planId) {
        const {
          data: { user },
        } = await supabase.auth.getUser();

        if (!user) {
          window.showToast("Please login to purchase!", "warning");
          setTimeout(() => {
            // Redirect with current page as a parameter
            window.location.href = `login.html?redirect=index.html&plan=${planId}`;
          }, 800);
          return;
        }

        // 1. Check existing active plan
        const { data: activePlan } = await supabase
          .from("user_plans")
          .select("*")
          .eq("user_id", user.id)
          .eq("is_active", true)
          .maybeSingle();

        if (activePlan) {
          window.showToast(
            "You already have an active plan running!",
            "warning"
          );
          return;
        }

        // 2. Fetch selected plan details
        const { data: plan, error: planError } = await supabase
          .from("plans")
          .select("*")
          .eq("id", planId)
          .single();

        if (planError || !plan) {
          console.error("Plan fetch failed:", planError);
          window.showToast("Plan not found!", "error");
          return;
        }

        // 3. Calculate start and end dates
        const start = new Date();
        const end = new Date();

        // Calculate end date based on duration (assuming duration is in months)
        const months = parseInt(plan.duration);
        end.setMonth(end.getMonth() + (isNaN(months) ? 1 : months));

        const start_date = start.toISOString().slice(0, 10);
        const end_date = end.toISOString().slice(0, 10);

        // 4. Insert new plan record
        const { error: insertError } = await supabase
          .from("user_plans")
          .insert({
            user_id: user.id,
            plan_id: plan.id,
            start_date,
            end_date,
            is_active: true,
          });

        if (insertError) {
          console.error("Insert failed:", insertError);
          window.showToast("Plan purchase failed!", "error");
          return;
        }

        window.showToast("Plan Purchased Successfully!", "success");

        setTimeout(() => {
          window.location.href = "user-dashboard.html?tab=plan";
        }, 1200);
      };
    </script>
    <!-- END: Supabase Auth & Data Scripts (Type: module) -->
  </body>
</html>
